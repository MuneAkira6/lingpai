## 计算机网络实验-模拟令牌总线协议

### 实验任务：模拟令牌总线协议

### 实验目的：

要求学生掌握Socket技术及令牌总线工作过程 

### 实验内容：

1. 要求学生掌握利用Socket进行编程的技术

2. 8台主机（用进程来实现），主机号为1-8
3. 产生一个令牌，绕着8台主机依照主机号进行轮转（即1号发给2号，2号发给3号，...，8号发给1号），一秒钟转移一次
4. 程序模拟主机随机发送（6秒内选择随机数），（内容格式为：源目主机号+“：”+目的主机号+“：”+Hello Baby）
5. 发送前，查看当前是否有有令牌，如果没有令牌，则等待
6. 如果有令牌，可以发送数据（目的主机号随机产生），假定数据传输过程为2秒，此时不再发送令牌，只发送数据
7. 数据依然按照主机号发送
8. 接收方接受后，显示内容
9. 发送主机最后收到自己的数据，重新发送令牌
10. 必须采用图形界面，每个程序可以设置自己的主机号，查看运行过程

### 详细设计

- 采用node.js作为开发语言，使用node.js自带的websocket库模拟socket通信。

- app0.js ~app8.js是服务器端代码，主要包含八个主机和令牌轮转程序的代码，负责与客户端（index.html）建立通信。

- app.js是网页管理服务。因为八个主机本身只处理自身的socket连接，没有发送网页的功能，所以app.js负责建立网站服务，采用express框架。

- index.html是客户端。负责与后端建立通信，展示图形界面。

### 我不想听你废话了，快告诉我怎么用？

1. 首先，安装并配置好node.js开发环境。我自己的开发环境是macOS 11.3.1 + node.js 15.7.0 + vs code。

2. 在终端(windows为cmd)同时用node同时开启app0.js app1.js app2.js...app8.js以及timer.js。

    注意，以上这些文件需要同时开启，你可以通过同时开八个终端并分别输入以下代码来实现：

    `node app0.js` 

    `node app1.js` 

    ...

    `node timer.js`

    你也可以用一句命令同时开启。可以这样写（在每个指令后面加一个'&'）：

    `node app0.js & node app1.js & node app2.js & node app3.js & node app4.js & node app5.js & node app6.js & node app7.js & node app8.js & node timer.js &`

    这是我的截图（我使用了绝对路径）：

    ![](https://i.bmp.ovh/imgs/2021/06/68e7823963fd6bda.png)

3. 开启网页管理服务(app.js)。

    `node app.js`

    如果你使用的是vs code，你也可以在vs code中使用node，此方法略过不表。

4. 上述所有服务都开启后，再打开浏览器，在地址栏输入`localhost:8080`，如果出现类似下面这样的页面，表示运行成功：

    ![](https://i.bmp.ovh/imgs/2021/06/5694d9b70aa2018d.png)

    对上面这张图的解释：八个方框表示八个主机，主机边框为黑色，表示此刻该主机正在准备数据；边框为蓝色表示数据以准备好，等待发送。主机背景色为红色，表示令牌当前在该主机处，该主机可以发送数据。绿色的线表示数据发送方向。图中主机4发送给主机2，当数据发送完成后主机2上出现'Host4 sends data to Host2'的提示。

5. 运行结束以后别忘了杀掉所有node进程。在终端中输入：

    `killall node`

    否则你的电脑风扇会狂转...

### 总结

4月份拿到实验题目，助教推荐用Qt写，而我当时在学前端开发，会写网页，也了解一点node.js，就想试试用js能不能写出来，一写才发现是大坑。😂

js是单线程的，写同步代码非常容易阻塞，写异步代码又与课题要求不符（令牌必须时刻准备跳转，写异步代码的话无法控制），思前想后，最终用极为蹩脚的方式实现了，很不优雅，哎...